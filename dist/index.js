"use strict";function Logger(){this.logLevel=5,this.TYPE_CONSOLE="console",this.TYPE_DAILY_ROTATE_FILE="daily-rotate-file",this.ERROR_LOG_LEVEL={name:"error",level:1,fn:"error"},this.WARNING_LOG_LEVEL={name:"warning",level:2,fn:"warn"},this.INFO_LOG_LEVEL={name:"info",level:3,fn:"info"},this.VERBOSE_LOG_LEVEL={name:"verbose",level:4,fn:"verbose"},this.DEBUG_LOG_LEVEL={name:"debug",level:5,fn:"debug"};var a=function(a,b){b=b||!1;var c={level:a.level,date:_.isFunction(a.timestamp)?a.timestamp():_.isNull(a.timestamp)?null:moment().format(),message:_.isUndefined(a.message)||_.isEmpty(a.message)?"":a.message,meta:!_.isUndefined(a.meta)&&Object.keys(a.meta).length?JSON.stringify(a.meta):""};_.has(a,"label")&&_.isFunction(a.label)&&(c.level=a.label(a.level.toLowerCase())),_.has(a,"timestamp")&&_.isFunction(a.timestamp)&&(c.date=a.timestamp()),b&&_.has(a,"colorize")&&_.isFunction(a.colorize)&&(b=a.colorize(a.level),c.level=chalk[b]("{}".format(a.label(a.level.toLowerCase()))));var d="{level} :";return _.isNull(c.date)||(d=["[{date}]",d].join(" ")),_.isUndefined(c.message)||_.isEmpty(c.message)||(d=[d,"{message}"].join(" ")),_.isUndefined(c.meta)||_.isEmpty(c.meta)||(d=[d,"{meta}"].join(" ")),d.format(c)},b=function(){return moment().format("DD/MM/YYYY HH:mm:ss")},c=function(a){var b=[{info:"info    "},{warn:"warning "},{error:"error   "},{debug:"debug   "},{verbose:"verbose "}],c=_.findIndex(b,a);return c>=0?_.first(_.values(b[c])):a},d=function(a){var b=[{info:"green"},{warn:"yellow"},{error:"red"},{debug:"blue"},{verbose:"white"}],c=_.findIndex(b,a);return c>=0?_.first(_.values(b[c])):"white"};this.consoleTransportFormatter=function(b){return a(b,!0)},this.dailyRotateFileTransportFormatter=function(b){return a(b,!1)},this.defaultConsoleTransport={level:"debug",handleExceptions:!1,json:!1,showLevel:!0,silent:!1,label:c,formatter:this.consoleTransportFormatter,timestamp:null,colorize:d},this.defaultDailyRotateTransportFile={name:"default-daily-rotate-transport",level:"verbose",dirname:"./",filename:uuid.v4(),handleExceptions:!0,json:!1,maxsize:5242880,maxFiles:5,colorize:!0,datePattern:"-yyyy-MM-dd.log",label:c,formatter:this.dailyRotateFileTransportFormatter,timestamp:b},this.winston=new winston.Logger({transports:[new winston.transports.Console(_.clone(this.defaultConsoleTransport))],exitOnError:!1})}var winston=require("winston"),_=require("lodash"),chalk=require("chalk"),moment=require("moment"),format=require("string-format"),uuid=require("uuid"),fs=require("fs"),path=require("path"),emmitter=require("events").EventEmitter,util=require("util");format.extend(String.prototype),winston.emitErrs=!1,util.inherits(Logger,emmitter),Logger.prototype.enableConsole=function(a){a=_.isBoolean(a)?a:!0,!_.isUndefined(this.winston.transports)||!_.isNull(this.winston.transports)&&_.isObject(this.winston.transports)?_.has(this.winston.transports,"console")&&_.has(this.winston.transports.console,"silent")&&(this.winston.transports.console.silent=!a,a&&this.info("[ Logger.enableConsole ] - enable console on current logger")):console.log(chalk.red("[ Logger.enableConsole ] - winston doesn't exists."))},Logger.prototype.disableConsole=function(){this.info("[ Logger.disableConsole ] - disable console on current logger"),this.enableConsole(!1)},Logger.prototype.success=function(a){return a=!_.isUndefined(a)&&!_.isNull(a)&_.isFunction(a)?a:function(){},this.on("success",a),this},Logger.prototype.failure=function(a){return a=!_.isUndefined(a)&&!_.isNull(a)&_.isFunction(a)?a:function(){},this.on("failure",a),this},Logger.prototype.addDailyRotateTransport=function(a,b,c,d){(_.isUndefined(a)||!_.isString(a)||_.isNull(a))&&(a="./",this.warning('[ Logger.addDailyRotateTransport ] - Invalid path given. Using default path "./"')),a=path.normalize(a),a=path.resolve(a);var e=this;return fs.lstat(a,function(d,f){f&&f.isDirectory()?fs.access(a,fs.F_OK|fs.R_OK|fs.W_OK,function(d){if(d)e.error(["[ Logger.addDailyRotateTransport ] - Cannot read and write on",a," - operation aborted !"].join(" "));else{var f=_.clone(e.defaultDailyRotateTransportFile);_.extend(f,{dirname:a}),_.isUndefined(c)||_.isNull(c)||!_.isObject(c)||_.extend(f,c),_.isUndefined(b)||_.isEmpty(b)||_.isNull(b)||(_.isString(b)&&!_.isEmpty(b)?_.extend(f,{filename:b}):e.warning(["[ Logger.addDailyRotateTransport ] - filename is not a string. restore filename to ",f.filename].join(" "))),_.isUndefined(e.winston)?(console.log(chalk.red("[ Logger.addDailyRotateTransport ] - Cannot add new transport. instance is invalid")),e.emit("failure")):(_.has(e.winston.transports,f.name)&&(e.warning(["[ Logger.addDailyRotateTransport ] - A transport with the name",f.name,"already exists. Removing current before adding new transport"].join(" ")),e.winston.remove(f.name)),e.winston.add(winston.transports.DailyRotateFile,f),b=[a,f.filename,moment().format(f.datePattern.replace(".log","").toUpperCase()),".log"].join(""),e.info(["[ Logger.addDailyRotateTransport ] - Success ! Datas are logged in",b].join(" ")),e.emit("success"))}}):e.error(["[ Logger.addDailyRotateTransport ] - Directory path : [",a,"] is invalid. Operation aborted !"].join(" "))}),this},Logger.prototype.process=function(a,b,c){try{if(_.isUndefined(this.winston)||_.isNull(this.winston))throw"Cannot une winston logger. instance is undefined or null";if(!_.has(a,"fn"))throw"Fn function is undefined or null. cannot process log";_.isUndefined(c)?this.winston.log(a.fn,b):this.winston.log(a.fn,b,c)}catch(d){console.log(chalk.red(["[ Logger.process ] -",d].join(" ")))}},Logger.prototype.changeLevel=function(a,b,c){var d=[this.ERROR_LOG_LEVEL,this.WARNING_LOG_LEVEL,this.INFO_LOG_LEVEL,this.VERBOSE_LOG_LEVEL,this.DEBUG_LOG_LEVEL];return this.logLevel=b,this.info(a!=b?!_.isUndefined(c)&&_.isBoolean(c)&&c?["[ Logger.changeLevel ] - Try to change level from",d[a-1].name,"to",d[b-1].name].join(" "):["[ Logger.changeLevel ] - Try to change level from",d[b-1].name,"to",d[a-1].name].join(" "):["[ Logger.changeLevel ] - Kepping level to",d[this.logLevel-1].name].join(" ")),(!_.isUndefined(this.winston.transports)||!_.isNull(this.winston.transports)&&_.isObject(this.winston.transports))&&_.each(this.winston.transports,function(a){_.has(a,"level")&&(a.level=d[this.logLevel-1].name)},this),this},Logger.prototype.more=function(){var a=this.logLevel,b=5>a?a+1:a;return this.info("[ Logger.more ] - Requesting more logs"),this.changeLevel(a,b)},Logger.prototype.less=function(){var a=this.logLevel,b=a>1?a-1:a;return this.info("[ Logger.less ] - Requesting less logs"),this.changeLevel(a,b,!0)},Logger.prototype.verbose=function(a,b){this.process(this.VERBOSE_LOG_LEVEL,a,b)},Logger.prototype.info=function(a,b){this.process(this.INFO_LOG_LEVEL,a,b)},Logger.prototype.warning=function(a,b){this.process(this.WARNING_LOG_LEVEL,a,b)},Logger.prototype.error=function(a,b){this.process(this.ERROR_LOG_LEVEL,a,b)},Logger.prototype.debug=function(a,b){this.process(this.DEBUG_LOG_LEVEL,a,b)},Logger.prototype.banner=function(a,b){var c={color:"white",bgColor:"bgBlack",topDelimiter:"-",bottomDelimiter:"-",leftDelimiter:"|",rightDelimiter:"|"};!_.isUndefined(b)&&_.has(b,"color")&&_.has(b,"bgColor")&&(_.startsWith("bg",b.bgColor)||(b.bgColor=["bg",_.capitalize(b.bgColor.toLowerCase())].join("")),_.extend(c,b));var d=[c.leftDelimiter,a,c.rightDelimiter].join(" ");_.has(chalk.styles,c.color)&&_.has(chalk.styles,c.bgColor)?(console.log(chalk[c.color][c.bgColor](_.repeat(c.topDelimiter,d.length))),console.log(chalk[c.color][c.bgColor](d)),console.log(chalk[c.color][c.bgColor](_.repeat(c.bottomDelimiter,d.length)))):(this.warning("[ Logger.Banner ] - Cannot use custom style given style is invalid. please read chalk documentation. Logging with current shell config."),console.log(_.repeat(c.topDelimiter,d.length)),console.log(d),console.log(_.repeat(c.bottomDelimiter,d.length)))},module.exports=new Logger;